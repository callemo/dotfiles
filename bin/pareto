#!/bin/sh
# usage: pareto [-n column] [files...]
# Summarizes numeric columns with percent and cumulative percent
# of the total.
#
# Options:
#   -n N    Column number to analyze (default: 1)

usage() { sed -En '2,/^[^#]/ s/^# //p' "$0" >&2; }

while getopts :n:h f
do
	case $f in
	h)  usage; exit 0;;
	n)  narg=$OPTARG;;
	\?) usage; exit 2;;
	esac
done
shift $((OPTIND - 1))

awk 'BEGIN {
	n = '"${narg:-1}"'
	OFS = "\t"
}
{
	line[NR] = $0
	num[NR] = $n
	sum += $n
	csum[NR] = sum
}
END {
	for (i = 1; i <= NR; i++)
		print line[i], \
		sprintf("%0.2f%%", num[i] / sum * 100), \
		sprintf("%0.2f%%", csum[i] / sum * 100)
}' "$@"
