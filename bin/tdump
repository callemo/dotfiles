#!/bin/sh
# tdump: dumps tmux's session windows, and panes.

prefix="${0##*/}:"
log() { echo "$prefix" "$@" >&2; }
fatal() { log "$@"; exit 1; }

f="${1:-$HOME/tmux.dump}"

{
	tmux display -p '#S	#{session_path}' || fatal 'no session'
	tmux list-windows -F '#{window_index}' | awk '
	BEGIN { f = "#{window_index}	#{window_name}	#{pane_index}" \
				"	#{pane_current_path}" }
		  { system("tmux list-panes -t " $1 " -F '\''" f "'\''") }'
} >"$f"

