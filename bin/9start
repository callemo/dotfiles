#!/bin/sh
# Starts Plan 9's Acme.

set -a
ENV="$DOTFILES/9.sh"
EDITOR=E
PAGER=nobs
acmeshell="$SHELL"
home="$HOME"
user="$USER"
set +a

set -- -a "$@"
pgrep -q plumber || plumber &

case $(uname) in
Darwin)
	export SHELL=/bin/dash
	export acmeshell=/bin/dash
	varfont="/lib/font/bit/lucsans/euro.8.font,/mnt/font/LucidaGrande/30a/font"
	if 9p ls font | grep -Eq '^SFMono-Medium$'
	then
		fixfont="/lib/font/bit/lucm/unicode.9.font,/mnt/font/SFMono-Medium/28a/font"
	else
		fixfont="/lib/font/bit/lucm/unicode.9.font,/mnt/font/Menlo-Regular/28a/font"
	fi
	set -- -f "$varfont" -F "$fixfont" "$@"
	pgrep -q fontsrv || fontsrv &
	;;
esac

PATH="$DOTFILES/acme/bin:$PATH" exec "${PLAN9:-/usr/local/plan9}"/bin/acme "$@"
