#!/bin/sh
# tmux-load: loads a tmux session

f="${1:-$HOME/tmux.dump}"
d='          '

awk '
BEGIN   { FS = "'"$d"'"; last = -1 }
NR == 1 { cmd = sprintf("tmux new -c '\''%s'\''", $1) }

$1 == "p"  {
    win = $2

    if (win == last )
        cmd = cmd sprintf(" \\; splitw -c '\''%s'\''", $4)
    else
        cmd = cmd sprintf(" \\; neww -c '\''%s'\''", $4)

    last = win
}

$1 == "w" {
    win = $2

    if ($3 ~ /\*/)
        active = win

    if ($5 == "off")
        cmd = cmd sprintf(" \\; renamew -t %d '\''%s'\''", win, $4)

    # cmd = cmd sprintf(" \\; selectl -t %d '\''%s'\''", win, $6)
}

END     { cmd = cmd " \\; selectw -t " active
          system(cmd) }' "$f"
